2007-01-18  Sebastien Merle  <sebastien@fluendo.com>

	* flumotion/transcoder/watcher.py: 
	* flumotion/transcoder/transcoder.py: 
	Now the files that failed and are moved to the error directory
	can be moved back to incoming and transcoded again without 
	having to restart the transcoder.
	* flumotion/transcoder/config.py: 
	Now keep the extention of the input file to prevent name clash
	in case of diffrent types of input files with a same name,
	can be deactivated setting the property appendext to false in
	the profiles configuration sections.
	Added pptimeout, gettimeout and transtimeout properties 
	to the customer section to configure the post-process, 
	get request and transcoding timeout.
	* flumotion/transcoder/trans.py: 
	Better exception handling for gstreamer errors.
	The timeout can now be specified to the constructor.
	* flumotion/transcoder/job.py: 
	Now quote the filenames before inserting it in the URLs.
	Added a timeout for post-processes.
	Made files to be moved to outgoing only if ALL profiles are successfull.
	Added a getrequest option in each profiles, the customer's one is
	called only one time if all profiles are transcoded well, and
	the profile getrequest is called for each profiles with more
	information related to the output file (like duration...).
	Made the errgetreq to be called only one time and for any kind of error.
	Better overrall exception catching to prevent zombie jobs.
	* bin/flumotion-thumbnailer.sh:
	Added a parameter to be able to get the source video from incomming.

2007-01-08  Sebastien Merle  <sebastien@fluendo.com>

	* bin/flumotion-thumbnailer.sh:
	Add a script to make a JPG thumbnail of a video.
	It uses totem-video-thumbnailer and ImageMagick convert.
	It test for output and loop if no thumbnail has been
	generated because totem-video-thumbnailer may timeout
	under heavy load.
	
2007-01-05  Thomas Vander Stichele  <thomas at apestaart dot org>

	* configure.ac:
	  back to TRUNK

2007-01-05  Sebastien Merle  <sebastien@fluendo.com>

	* flumotion/transcoder/transcoder.py: 
	Changed os.popen for popen2.Popen4 to corect exit code retrieval
	
	* flumotion/transcoder/job.py:
	Now handle nicely the filenames with spaces in the post-process command.

2007-01-05  Sebastien Merle  <sebastien@fluendo.com>

	* flumotion/transcoder/config.py: 
	* flumotion/transcoder/job.py:
	Changed post-process parameter format from ${XX_XX} to %(xxxXxx)s
	for consistency with GET request.
	To automatically generate thumbnails you should now use:
	postprocess = totem-video-thumbnailer %(file)s %(outputRoot)s/%(relFile)s.png
	
	* flumotion/transcoder/config.py: 
	Added a configuration option for error GET request: errgetreq
	Added a configuration option for error notification mail: errmail
	
	* flumotion/transcoder/job.py:
	Made a refactoring of the profile processing.
	Fix #552 and definitely fix #554
	Added a GET request on error: Fix #551

	* flumotion/transcoder/transcoder.py: 
	Send a mail when a transcoding fail: Fix #518		

2007-01-04  Thomas Vander Stichele  <thomas at apestaart dot org>

	* Makefile.am:
	* configure.ac:
	* src/Makefile.am:
	* src/mmf-crc.c:
	* flumotion-transcoder.spec.in:
	  Add the mmf-crc postprocessing binary to fix mmf files.

2007-01-04  Thomas Vander Stichele  <thomas at apestaart dot org>

	* flumotion/transcoder/trans.py:
	  Also work when audiorate is not set and audiochannels is.

2007-01-04  Sebastien Merle  <sebastien@fluendo.com>

	* flumotion/transcoder/job.py: 
	Do GET request and post-process even if linkDir is not set.
	Fix #554	

2007-01-03  Sebastien Merle  <sebastien@fluendo.com>

	* flumotion-transcoder.spec.in: 
	Make sure that trunk packages are treates as having a later
	version that release packages.
	Better fix needed ? See fsp revision 4705

2006-12-29  Sebastien Merle  <sebastien@fluendo.com>

	* flumotion/transcoder/config.py: 
	* flumotion/transcoder/job.py: 
	Added some variables to be substituted in the post-process command line:
	${REL_FILE} ${INPUT_ROOT} ${OUTPUT_ROOT} 
	${ERROR_ROOT} ${LINK_ROOT} ${WORK_ROOT}
	For example, to automatically generate thumbnails, add:
	postprocess = totem-video-thumbnailer ${FILE} ${OUTPUT_ROOT}/${REL_FILE}.png

2006-12-19  Sebastien Merle  <sebastien@fluendo.com>

	* flumotion/transcoder/job.py: 
	* flumotion/transcoder/config.py: 
	Added an option to execute a post-processing command on the 
	output files. The config option is named 'postprocess' and 
	is None by default so no post-processing. The option value should
	be a command line with a ${FILE} parameter that will be substituted
	by the absolute path of a transcoded file before being moved 
	to the outgoing directory.
	Ex: postprocess = md5sum -b ${FILE}
	Fixes #517

2006-12-18  Thomas Vander Stichele  <thomas at apestaart dot org>

	* flumotion/transcoder/job.py:
	  also warn when the discoverer fails to think a file is media

2006-12-15  Thomas Vander Stichele  <thomas at apestaart dot org>

	* flumotion-transcoder.spec.in:
	  require flumotion

2006-11-30  Michael Smith  <msmith@fluendo.com>

	* flumotion/transcoder/trans.py:
	  Increase max queue size in time, disable buffers.
	  We retain max size in bytes, to avoid Infinite Memory Usage.

2006-11-29  Thomas Vander Stichele  <thomas at apestaart dot org>

	* flumotion/transcoder/trans.py:
	  add debugging for when a pad gets added so that I can see why
	  I have five pads on one file

2006-11-28  Michael Smith  <msmith@fluendo.com>

	* flumotion/transcoder/transcoder.py:
	  Log full command line (modulo quoting issues) at debug level.

2006-11-27  Michael Smith  <msmith@fluendo.com>

	* flumotion/transcoder/job.py:
	  Fix up deferred usage so we don't get tracebacks/fatal failures if
	  the get request fails the first time.

2006-11-22  Michael Smith  <msmith@fluendo.com>

	* flumotion/transcoder/trans.py:
	  Use larger queues, to avoid queue lockups on coarsely muxed files.

2006-11-15  Andy Wingo  <wingo@pobox.com>

	* flumotion/transcoder/job.py (Job.finish, Job.fail): _exit
	instead of exit, so as to work correctly from deferred callbacks
	and other quoi.
	(Job.finish): Thanks distributed pychecker!

2006-11-13  Michael Smith  <msmith@fluendo.com>

	* conf/flumotion-transcoder.ini:
	  Use mp3parse in flv example config.

	* flumotion/transcoder/trans.py:
	  Implement gst_parse_bin_from_description() in python.
	  Use it for creating audio, video encoders, so we can have a bin
	  rather than a single element.

2006-11-09  Andy Wingo  <wingo@pobox.com>

	* flumotion/transcoder/transcoder.py
	(JobProcessProtocol.sendMessage): Fix handling of translatables.
	Fixes #402.

2006-11-07  Andy Wingo  <wingo@pobox.com>

	* flumotion/transcoder/config.py (Profile.__init__): Don't default
	to 30 channels of audio at 30 Hz.

	* flumotion/transcoder/trans.py (MultiTranscoder._makeEncodingBin)
	(MultiTranscoder._makeAudioEncodebin)
	(MultiTranscoder._makeVideoEncodebin)
	(MultiTranscoder._makePipeline): Construct the whole pipeline at
	the beginning, only linking the tee's sinks at PAUSED.

	* conf/flumotion-transcoder-test.ini: Add another config for
	testing two-at-a-time goodness.

2006-11-07  Edward Hervey  <edward@fluendo.com>

	* flumotion/transcoder/trans.py:
	Set the maximum bytes size of decodebin's internal queues to
	10 Mbytes.

2006-11-07  Andy Wingo  <wingo@pobox.com>

	* flumotion/transcoder/job.py (Job.transcode_done): Tell the
	output discoverers whether they should expect audio and video.
	(Job.output_discovered): Consider the output a failure if e.g. we
	expected video but didn't get it. Fixes #389.

2006-11-02  Andy Wingo  <wingo@pobox.com>

	* flumotion/transcoder/transcoder.py (Transcoder.startJob): Damn
	you Mike Smith!

2006-11-02  Thomas Vander Stichele  <thomas at apestaart dot org>

	* doc/redhat/flumotion-transcoder.init:
	  daemon now removes its own pid file

2006-11-02  Andy Wingo  <wingo@pobox.com>

	* flumotion/transcoder/Makefile.am (component_PYTHON): Dist
	job.py.

	* flumotion/transcoder/transcoder.py (InputHandler): Removed, no
	longer necessary.
	(JobProcessProtocol): Implemented a process protocol for jobs.
	(Transcoder): Track watched directories directly. Use the
	JobProcessProtocol to spawn jobs, allowing us to spawn multiple
	jobs. Sort tasks using a priority queue.

	* flumotion/transcoder/main.py (main): No need to tell the
	transcoder to run.

	* flumotion/transcoder/job.py (Job.get_output_filename): Use
	getOutputBasename from the profile.
	(Job.perform_get_request): Fix pychecker-caught errors.
	(usage): Fix usage.
	(Job.output_recognized): Update to use new cortado arguments, as
	in [4354], [4355], [4356].

	* conf/flumotion-transcoder-test.ini (maxjobs): Add maxjobs to the
	example.

	* flumotion/transcoder/config.py (Profile.getOutputBasename): New
	method.
	(Customer.alreadyProcessedFiles): New method.
	(Customer.alreadyProcessedFiles.all): Pithy!
	(Config.parse): Always set default values for [global] section.

	* flumotion/test/test_transcoder_config.py
	(TestConfigParser.testParseProfile): Test getOutputBasename.

	* misc/pycheckerhelp.py: Pacify pychecker?

	* flumotion/transcoder/config.py (Config): Make a SectionParser so
	that we can handle options in [global].

	* flumotion/test/test_transcoder_config.py
	(TestConfigParser.testParseFull): Test [global] parsing, and
	parsing of entire config files.

2006-11-01  Andy Wingo  <wingo@pobox.com>

	* flumotion/transcoder/job.py (Job): Implement a job object to do
	the transcode. Makes flumotion-transcoder-job work.

2006-11-01  Michael Smith  <msmith@fluendo.com>

	* flumotion/transcoder/transcoder.py:
	  Use true/false, not 1/0, because cortado doesn't understand the
	  latter.

2006-11-01  Michael Smith  <msmith@fluendo.com>

	* flumotion/transcoder/transcoder.py:
	  Missing c- on height check.

2006-11-01  Michael Smith  <msmith@fluendo.com>

	* flumotion/transcoder/transcoder.py:
	  Use New Hotness, not Old Crapness, when generating links to
	  cortado/gatekeeper.

2006-11-01  Thomas Vander Stichele  <thomas at apestaart dot org>

	* doc/redhat/flumotion-transcoder.init:
	  remove --log property since it was removed from the program

2006-11-01  Andy Wingo  <wingo@pobox.com>

	* flumotion/transcoder/main.py (daemonizeHelper): Don't force a
	dep on new flumotion.

2006-11-01  Thomas Vander Stichele  <thomas at apestaart dot org>

	* TODO:
	  add a note
	* flumotion-transcoder.spec.in:
	  package -job

2006-11-01  Andy Wingo  <wingo@pobox.com>

	* flumotion/transcoder/trans.py (calculateOutputSize)
	(getOutputVideoCaps): Factor out of the Profile object; these are
	just functions now.
	(MultiTranscoder._discoveredCb): Hah!

	* flumotion/transcoder/config.py (Config.parse): Fix parsing of
	whole files.

	* flumotion/transcoder/transcoder.py (InputHandler): Refactor to
	use the new config interface.
	(Transcoder): Refactor to use the new config interface.

	* bin/Makefile.am (sbin_SCRIPTS): 
	* bin/flumotion-transcoder-job.in: 
	* configure.ac: s/transcode-job/transcoder-job/.

	* flumotion/transcoder/config.py (Config.parse): Make sure we
	notice errors reading the config files.

	* flumotion/transcoder/main.py (main): Use the common daemonize
	facilities. Convert to the new config interface.

	* flumotion/transcoder/job.py (main): New file, not completely
	implemented yet.

	* bin/flumotion-transcoder-job.in: New file, will be what the
	transcoder will run.

	* bin/flumotion-transcoder.in: Make more conventional.

	* flumotion/transcoder/config.py (Customer.ensureDirs): Fix error
	caught by pychecker.
	(Customer.ensureDirs): Appeasement.

	* flumotion/test/test_transcoder_config.py (TestConfigParser):
	Remove a test stub.

2006-11-01  Michael Smith  <msmith@fluendo.com>

	* conf/flumotion-transcoder-test.ini:
	  Add my test config which just writes everything under /tmp/

2006-11-01  Andy Wingo  <wingo@pobox.com>

	* flumotion/transcoder/config.py (Profile.__init__): Add
	maxheight, maxwidth, extension properties.

	* flumotion/test/test_transcoder_config.py
	(TestConfigParser.testParseProfile): Test the profile parser.

	* flumotion/transcoder/config.py (Customer.ensureDirs): Factor out
	of __init__.
	(SectionParser.parseFromTable, Customer.__init__): Fix bugs caught
	by the test suite.

	* flumotion/test/test_transcoder_config.py
	(TestConfigParser.testParseCustomer): Test the customer parser.

	* flumotion/transcoder/Makefile.am (component_PYTHON): 
	* flumotion/transcoder/config.py: Refactor the config parser.

	* configure.ac: 
	* flumotion/Makefile.am: 
	* flumotion/test/Makefile.am: 
	* flumotion/test/__init__.py: 
	* flumotion/test/common.py: 
	* flumotion/test/test_transcoder_config.py: Add trial
	infrastructure.

2006-11-01  Michael Smith  <msmith@fluendo.com>

	* flumotion/transcoder/trans.py:
	* flumotion/transcoder/transcoder.py:
	  Add maxheight, maxwidth properties; doesn't change default
	  behaviour.

2006-11-01  Michael Smith  <msmith@fluendo.com>

	* flumotion/transcoder/trans.py:
	  Calculate input display aspect ratio correctly.

2006-11-01  Andy Wingo  <wingo@pobox.com>

	* README: Write a bit.

2006-11-01  Michael Smith  <msmith@fluendo.com>

	* flumotion/transcoder/transcoder.py:
	  Delete outputting 'framerate', since it was buggy, and is no longer
	  needed.
	  Don't divide by zero. Dividing by zero isn't cool.

2006-10-25  Edward Hervey  <edward@fluendo.com>

	* conf/flumotion-transcoder.ini:
	Added two new profiles, both Mpeg4Video and Raw Audio:
	_low : no change in video format, 800kbit/s
	_high : 720x576@25fps, 2Mbit/s, GOP of 10 frames

2006-10-24  Thomas Vander Stichele  <thomas at apestaart dot org>

	* flumotion/transcoder/transcoder.py:
	  don't move to errordirectory if it is not specified
	  use os._exit() in child to make sure we get out of the reactor

2006-10-24  Thomas Vander Stichele  <thomas at apestaart dot org>

	* flumotion/transcoder/trans.py:
	  remove audiorate, as it introduces clearly audible distortion
	  in the result files, and it seems to work fine without it

2006-10-24  Thomas Vander Stichele  <thomas at apestaart dot org>

	* conf/flumotion-transcoder.ini:
	* flumotion/transcoder/transcoder.py:
	  Add a "getrequest" config parameter through which creation
	  of an output file can be announced.  Can interpolate some
	  of the values related to the outgoing file.
	  Add example config for it.

2006-10-24  Thomas Vander Stichele  <thomas at apestaart dot org>

	* bin/flumotion-transcoder.in:
	* flumotion/transcoder/main.py:
	  Use twisted harder.

2006-10-24  Edward Hervey  <edward@fluendo.com>

	* conf/flumotion-transcoder.ini:
	Added example configuration for DV in Quicktime.
	Renamed the configurations to something more sensible.

2006-10-24  Thomas Vander Stichele  <thomas at apestaart dot org>

	* bin/flumotion-transcoder.in:
	  run as a twisted app

2006-10-21  Thomas Vander Stichele  <thomas at apestaart dot org>

	* Makefile.am:
	  add pychecker target
	* flumotion/transcoder/transcoder.py:
	  fix some bugs shown by pychecker

2006-10-21  Thomas Vander Stichele  <thomas at apestaart dot org>

	* configure.ac:
	  add misc setup.py
	* doc/redhat/flumotion-transcoder.init:
	  fix it up with the new pid writing code;
	  service flumotion-transcoder restart now works
	* flumotion/transcoder/main.py:
	  write pid file
	* flumotion/transcoder/trans.py:
	  remove unused imports
	* flumotion/transcoder/transcoder.py:
	  rename TranscoderTask to InputHandler since that's what it is
	  add errordirectory and move files there that had an error when
	  transcoding
	  fork for a task
	  fix a logic error in _nextTask that made it only ever run tasks
	  for one customer
	* flumotion/transcoder/watcher.py:
	  add a FIXME about a missing method

2006-10-19  Edward Hervey  <edward@fluendo.com>

	* flumotion/transcoder/trans.py:
	Invert the order of audio filters, it is now:
	RAWAUDIO ! audiorate ! audioconvert ! audioresample ! ENCODER
	Implement queue-overrun detection system for streams that don't
	emit 'no-more-pads'

2006-10-18  Thomas Vander Stichele  <thomas at apestaart dot org>

	* flumotion/transcoder/trans.py:
	* flumotion/transcoder/transcoder.py:
	* tests/ogger.py:
	  s/audiochanns/audiochannels/g

2006-10-17  Edward Hervey  <edward@fluendo.com>

	* flumotion/transcoder/trans.py:
	Added audiochanns property to specify the number of audio channels in
	output.
	Added audiorate in the audio encoding bin.
	Set scaling method of videoscale to bilinear.
	* flumotion/transcoder/transcoder.py:
	Added reason to the error signal, adjusted emission of that signal
	accordingly.
	* flumotion/transcoder/watcher.py:
	Fix for files not present before.
	* tests/ogger.py:
	Added specific rate and channel for ogger test profile.
	* TODO:
	Extended items to do and commented others.

2006-10-16  Thomas Vander Stichele  <thomas at apestaart dot org>

	* flumotion/transcoder/transcoder.py:
	  fix cortado link

2006-10-16  Thomas Vander Stichele  <thomas at apestaart dot org>

	* Makefile.am:
	* configure.ac:
	  add tests dir to be cleaned up
	* flumotion/transcoder/trans.py:
	  add timeout param to MultiTranscoder so testing is easier
	  don't use lines longer than 80 chars

2006-10-16  Edward Hervey  <edward@fluendo.com>

	* flumotion/transcoder/trans.py:
	* flumotion/transcoder/transcoder.py:
	* flumotion/transcoder/watcher.py:
	Syntax fixes. Serialize state_change and signal emissions in
	main thread.

2006-10-16  Edward Hervey  <edward@fluendo.com>

	* flumotion/transcoder/Makefile.am:
	* flumotion/transcoder/watcher.py:
	New Watcher class with two subclasses:
	DirectoryWatcher to watch a directory
	FilesWatcher to watch a series of files
	* flumotion/transcoder/trans.py:
	Use the FilesWatcher to figure out when a Pipeline is no longer
	outputting data (deadlocked?) and report the error.
	If the discoverer reports a file isn't a media file, include the
	discovered mimetypes in the logs.
	* flumotion/transcoder/transcoder.py:
	Use the DirectoryWatcher from watcher.py
	small fixes.

2006-10-16  Edward Hervey  <edward@fluendo.com>

	* flumotion/transcoder/trans.py:
	(_decodebinNoMorePadsCb): handle case where decodebin emits
	'no-more-pads' more than once. Make sure we don't connect pads to
	non-existent bins.
	(_buildEncodingBin): Don't create audio (or video) bin if the source
	media doesn't have audio (or video). Don't put a time limit on the
	pre-encoder queues.

2006-10-15  Thomas Vander Stichele  <thomas at apestaart dot org>

	* TODO:
	  add things to work on
	* flumotion/transcoder/trans.py:
	* flumotion/transcoder/transcoder.py:
	  make the transcoder daemon use the factored-out
	  MultiTranscoder object
	  Clean up output, variable names, logging, ...

2006-10-15  Thomas Vander Stichele  <thomas at apestaart dot org>

	* flumotion/transcoder/trans.py:
	* tests/ogger.py:
	  further cleanups
	  handle non-existing files

2006-10-15  Thomas Vander Stichele  <thomas at apestaart dot org>

	* flumotion/transcoder/trans.py:
	  further cleanups, now has a MultiTranscoder separated out
	  that we can test standalone
	* tests/ogger.py:
	  fix up test for standalone MultiTranscoder

2006-10-13  Thomas Vander Stichele  <thomas at apestaart dot org>

	* flumotion-transcoder.spec.in:
	  add dep
	* flumotion/transcoder/transcoder.py:
	  write out a full iframe line
	  round up width and height of applet to multiple of 16

2006-10-13  Thomas Vander Stichele  <thomas at apestaart dot org>

	* flumotion/transcoder/transcoder.py:
	  remove prints, clean up logging a little

2006-10-13  Thomas Vander Stichele  <thomas at apestaart dot org>

	* conf/flumotion-transcoder.ini:
	* flumotion/transcoder/main.py:
	* flumotion/transcoder/transcoder.py:
	  add discovery of transcoded files
	  add generation of .link files for .ogg files that can be served
	  by cortado

2006-10-12  Thomas Vander Stichele  <thomas at apestaart dot org>

	* Makefile.am:
	* transcoder/Makefile.am:
	  pass distcheck

2006-10-12  Thomas Vander Stichele  <thomas at apestaart dot org>

	* Makefile.am:
	* configure.ac:
	* doc/redhat/flutterd.init:
	* doc/redhat/flutterd.sysconfig:
	* flutter.spec.in:
	  rename to flumotion-transcoder

2006-10-12  Thomas Vander Stichele  <thomas at apestaart dot org>

	* bin/Makefile.am:
	* bin/flumotion-transcoder.in:
	* configure.ac:
	* flumotion/__init__.py:
	* flumotion/transcoder/__init__.py:
	* flumotion/transcoder/main.py:
	* flumotion/transcoder/transcoder.py:
	  split out file in modules and a simple script that boots into them

2006-10-12  Thomas Vander Stichele  <thomas at apestaart dot org>

	* configure.ac:
	  check for Flumotion
	* bin/flutterd:
	  use flumotion logging
	  add daemonize and options parsing

2006-10-12  Thomas Vander Stichele  <thomas at apestaart dot org>

	* configure.ac:
	* misc/preamble.py:
	  turn into a flumotion project

2006-10-12  Thomas Vander Stichele  <thomas at apestaart dot org>

	* bin/flutterd:
	  make documentation and comments respect 80 character width
	  add/fix up logging so the log says something useful

2006-10-12  Thomas Vander Stichele  <thomas at apestaart dot org>

	* bin/flutterd:
	  remove print's that should not be there
	* configure.ac:
	  remove check for python headers
	* flutter.spec.in:
	  add buildrequires

2006-10-06  Edward Hervey  <edward@fluendo.com>

	* bin/flutterd:
	Implemented code to create proper video caps depending on:
	_input width, height and pixel-aspect-ratio
	_configured width and/or height and/or pixel-aspect-ratio
	_configured framerate

2006-10-05  Thomas Vander Stichele  <thomas at apestaart dot org>

	* conf/flutterd.ini:
	* flutter.spec.in:
	* test.ini:
	  update spec file and config

2006-10-05  Thomas Vander Stichele  <thomas at apestaart dot org>

	* doc/redhat/flutterd.init:
	* doc/redhat/flutterd.sysconfig:
	* flutter.spec.in:
	* misc/Makefile.am:
	* misc/preamble.py:
	  more autotools goodness

2006-10-05  Thomas Vander Stichele  <thomas at apestaart dot org>

	* LICENSE.Flumotion:
	* Makefile.am:
	* autogen.sh:
	* bin/Makefile.am:
	* configure.ac:
	* flutterd:
	  adding autotools spread

2006-10-05  Edward Hervey  <edward@fluendo.com>

	* flutrans.py:
	* test.ini:
	Initial revision of the Fluendo Transcoding Daemon
