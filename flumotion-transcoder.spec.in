%{!?gstreamer:  %define         gstreamer       gstreamer}

Name:           @PACKAGE@
Version:        @VERSION@
Release:        @RELEASE@
Summary:        Flumotion Transcoder

Group:          Applications/Internet
License:	Proprietary
URL:            http://www.fluendo.com/
Source:         %{name}-%{version}.tar.bz2
BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root

Requires:	%{gstreamer}
Requires:       flumotion

# sigh, libtool
BuildRequires:  gcc-c++

BuildRequires:	%{gstreamer}-devel >= @GST_010_REQ@
BuildRequires:	%{gstreamer}-python
BuildRequires:	flumotion
BuildRequires:	pygtk2-devel

%description
Flumotion Transcoder.

%prep
%setup -q

%build
%configure

make

%install
rm -rf $RPM_BUILD_ROOT

# use DESTDIR so compiled python files get tagged correctly with their
# final location
make DESTDIR=$RPM_BUILD_ROOT install

# create config dir
install -d $RPM_BUILD_ROOT%{_sysconfdir}/flumotion-transcoder

# install service files
install -d $RPM_BUILD_ROOT%{_sysconfdir}/rc.d/init.d
install -m 755 \
        doc/redhat/flumotion-transcoder.init \
        $RPM_BUILD_ROOT%{_sysconfdir}/rc.d/init.d/flumotion-transcoder

install -d $RPM_BUILD_ROOT%{_sysconfdir}/sysconfig
install -m 644 \
        doc/redhat/flumotion-transcoder.sysconfig \
        $RPM_BUILD_ROOT%{_sysconfdir}/sysconfig/flumotion-transcoder

install -d $RPM_BUILD_ROOT%{_sysconfdir}
install -m 644 \
        conf/flumotion-transcoder.ini \
        $RPM_BUILD_ROOT%{_sysconfdir}

# create srv and tmp dir
install -d $RPM_BUILD_ROOT/srv/flumotion/transcoder
install -d $RPM_BUILD_ROOT%{_localstatedir}/flumotion/transcoder
%post
/sbin/chkconfig --add flumotion-transcoder

%preun
# if removal and not upgrade, stop the processes, clean up locks
if [ $1 -eq 0 ]
then
  /sbin/service flumotion-transcoder stop

  /sbin/chkconfig --del flumotion-transcoder

  rm -rf %{_localstatedir}/flumotion/transcoder*
fi

%files
%defattr(-,root,root,-)
%doc ChangeLog COPYING README AUTHORS LICENSE.Flumotion
%{_sbindir}/flumotion-transcoder
%{_sbindir}/flumotion-transcoder-job

%{_libdir}/flumotion
%{_libdir}/python?.?/site-packages/transcoder

%attr(750,flumotion,root) %{_sysconfdir}/rc.d/init.d/flumotion-transcoder
%attr(640,flumotion,root) %config(noreplace) %{_sysconfdir}/flumotion-transcoder.ini
%attr(640,flumotion,root) %config(noreplace) %{_sysconfdir}/sysconfig/flumotion-transcoder
%dir %attr(750,flumotion,root) %{_localstatedir}/flumotion/transcoder
%dir %attr(750,flumotion,root) /srv/flumotion/transcoder

%changelog
* Fri Dec 15 2006 Thomas Vander Stichele <thomas at apestaart dot org>
- require flumotion

* Thu Oct 05 2006 Thomas Vander Stichele <thomas at apestaart dot org>
- first spec file
